<% content_for :breadcrumb do %>
  <%= breadcrumbs ["Settings", settings_path], "Company Setup"%>
<% end %>

<div class="pa4">
  <div class="flex flex-column justify-between bg-white box--shadow">
    <div class="pa4 min-h-300">
      <div class="fl w-100 flex flex-column width-100">
        <h5 class="tl pa0 ma0 h5--font dark-grey ttc">Metrc Integration</h5>
        <p class="mt2 body-1 grey">
          Let's get a few details of your Metrc account.
        </p>
        <%= form_with model: @company_info, url: metrc_setup_settings_company_metrc_integrations_path, local: true do |f| %>
            <div class="flex flex-column mt3">
              <div class="w-40">
                  <%= f.label "User Key", class: "db mb1 grey subtitle-2 ttc" %>
                  <%= f.text_field :metrc_user_key, 
                      value: @company_info.metrc_user_key,
                      class: "grey ba b--light-grey br2 outline-0 pa2 db w-100" %>
              </div>
            </div>

            <div class="ph2 flex flex-row justify-between items-center " style="">
              <div class="dim flex flex-row items-center pointer">
              </div>

              <div class="flex flex-row items-center">
              <%= f.submit "Save",
                  class: "ttu button--font white link dim bg-orange bn box--br3 ph2 pv2 dib pointer" %>
              </div>
            </div>
        <% end %>
      </div>
    </div>

    <div class="dt pb4" style="table-layout: auto">
        <div class="dt-row">
          <div class="b dtc pa4 pv3 bg-black-10">
            Data
          </div>
          <div class="b dtc tc pv3 bg-black-10">
            Last Updated At
          </div>
          <div class="dtc tc pv3 bg-black-10"></div>
        </div>
      <%@metrc_histories.group_by{|d| d.category }.each do |group, histories| %>
        <div class="dt-row">
          <div class="b dtc pa4 pv2 bg-near-white underline">
            <%= group %>
          </div>
          <div class="dtc pa4 pv2 bg-near-white"></div>
          <div class="dtc pa4 pv2 bg-near-white"></div>
        </div>
        
        <% histories.each do |h|%>
          
          <div class="dt-row">
            <div class="dtc pa4 pv2 bg-black-5" style="width: 70%">
              <%= h.code %>
            </div>
            <div class="dtc tc pv2 bg-black-5" style="width: 15%"> <%= h.value ? h.value.strftime("%d-%m-%Y %H:%M") : "--" %></div>
            <div class="dtc tc pv2 bg-black-5" style="width: 15%">
              <a class="ttu button--font white link dim bg-orange bn box--br3 ph2 pv2 dib pointer" href="<%= update_metrc_settings_company_metrc_integrations_path(type: h.metrc_type ? h.metrc_type : "") %>" data-method="put" data-remote="false" >Update</a>
            </div>
          </div>
        <%end%>
      <%end%>
    </div>
    
</div>
