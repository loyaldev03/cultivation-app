<% content_for :breadcrumb do %>
  <%= breadcrumbs ["Settings", settings_path], ["Facilities", all_settings_facility_facilities_path], "Sections" %>
<% end %>


<div class="ph4 w-100 pb4 flex items-center">
  <div class="w-70">
    <div class="dropdown">
      <a class="dropbtn link ba dib bw1 b b--light-gray gray pa2 ph3 br4">
        <%= params[:facility_id].present? ? blank(Facility.find(params[:facility_id]).name) : 'View by facility' %>
      </a>
      <div class="dropdown-content">
        <%= link_to "Show all", settings_facility_sections_path, class: "pv3 ph3 bb b--light-gray f6 gray tc" %>
        <% Facility.all.each do |f| %>
          <%= link_to blank(f.name), settings_facility_sections_path(facility_id: f.id), class: "pv3 ph3 bb b--light-gray blue f6 tc" %>
        <% end %>
      </div>
      
    </div>
    <!-- <div class="dropdown ml2">
      <a class="dropbtn link ba dib bw1 b b--light-gray  gray pa2 ph3 br4">
        <%= params[:filter].present? ? params[:filter] : 'Filter' %>
      </a>
      <div class="dropdown-content">
        <% ["Completed", "Incomplete"].each do |f| %>
          <%= link_to f, settings_facility_rooms_path(filter: f), class: "pv3 ph3 bb b--light-gray blue f6 tc" %>
        <% end %>
      </div>
    </div> -->
  </div>
  <div class="w-30 tr">
    <%= link_to "+ Add section", '', class: 'link ba bw1 b b--blue blue pa2 ph3 br4' %>
  </div>
</div>

<div class="w-100 ph0">
  <table class="w-100 table collapse">
    <thead>
      <tr>
        <th class="f6 white pv3 tl pl4">#</th>
        <th class="f6 white pv3 tl w-10">Name</th>
        <th class="f6 white pv3 tl">Code</th>
        <th class="f6 white pv3 tl w-10">Description</th>
        <th class="f6 white pv3 tl ">Purpose</th>
        <th class="f6 white pv3 tl w-20 ">Purpose details</th>
        <th class="f6 white pv3 tl ">Facility</th>
        <th class="f6 white pv3 tl ">Room</th>
        <th class="f6 white pv3 tl ">Rows #</th>
        <th class="f6 white pv3 tc pr4" style="width: 130px;">Status</th>
        
      </tr>
    </thead>

    <tbody>
      <% @sections.each_with_index do |f, i| %>
        <tr>
          <td class="f6 tl pl4 gray"><%= i+1 %></td>
          <td class="f6 tl"><%= link_to blank(f.name), edit_settings_facility_section_path(f), class: 'link blue' %></td>
          <td class="f6 tl"><%= f.code %></td>
          <td class="f6 tl">
            <p class="ma0 mb1"><%= f.desc %></p>
          </td>
          <td class="f6 tl ">
            <%= (f.purpose || '').titlecase %>
          </td>
          <td class="f6 tl ">
            <%= (f.storage_types || f.cultivation_types || []).map(&:titlecase).join(", ") %>
          </td>
          <td class="f6 tl "><%= f.room.facility.name %></td>
          <td class="f6 tl "><%= f.room.name %></td>
          <td class="f6 tl "><%= f.rows.count %></td>
          <td class="f6 tc pr4">
            <% status = if !f.is_complete 
                        "Continue setup"
                      else
                        "active"
                      end
            %>
            <span class="<%=status %> status-bullet ba b bw1 b--blue blue pa1 ph2 br4 f7 dib"><%= status %></span>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>


